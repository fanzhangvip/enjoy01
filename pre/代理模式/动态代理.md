# 动态代理

## 什么是代理模式？

![代理模式](.\assets\image-20200101105311652.png)

- 给目标对象提供一个代理对象，并由代理对象控制对目标对象的引用
- 代理对象：起到中介作用，连接客户端和目标对象
> 电脑桌面的快捷方式。电脑对某个程序提供一个快捷方式（代理对象），快捷方式连接客户端和程序，客户端通过操作快捷方式就可以操作那个程序

### 主要作用
通过引入代理对象的方式来间接访问目标对象
###  解决的问题
防止直接访问目标对象给系统带来的不必要复杂性。

### 代理模式总结
- 优点
协调调用者和被调用者，降低了系统的耦合度
代理对象作为客户端和目标对象之间的中介，起到了保护目标对象的作用
-  缺点
由于在客户端和真实主题之间增加了代理对象，因此会造成请求的处理速度变慢；
实现代理模式需要额外的工作（有些代理模式的实现非常复杂），从而增加了系统实现的复杂度。 

### 应用场景
- 当需要为一个对象再不同的地址空间提供局部的代表时 
此时的代理模式称为远程代理：为一个对象在不同的地址空间提供局部代表。
隐藏一个对象存在于不同地址空间的事实；
远程机器可能具有更好的计算性能与处理速度，可以快速响应并处理客户端请求。
当需要创建开销非常大的对象时 
此时的代理模式称为虚拟代理：通过使用过一个小的对象代理一个大对象。

- 减少系统的开销。
当需要控制对原始对象的访问时 
此时的代理模式称为保护代理：控制目标对象的访问，给不同用户提供不同的访问权限 
目的：用来控制对真实对象的访问权限

- 当需要在访问对象时附加额外操作时 
此时的代理模式称为智能引用代理，额外操作包括耗时操作、计算访问次数等等 
目的：在不影响对象类的情况下，在访问对象时进行更多的操作
以上是最常用的使用场景，其他还包括：
防火墙代理：保护目标不让恶意用户靠近
Cache代理：为结果提供临时的存储空间，以便其他客户端调用 

## 为什么要使用动态代理
- 代理模式中的静态代理模式存在一些特点：
	- 1个静态代理 只服务1种类型的目标对象
若要服务多类型的目标对象，则需要为每种目标对象都实现一个静态代理对象 
	- 在目标对象较多的情况下，若采用静态代理，则会出现 静态代理对象量多、代码量大，从而导致代码复杂的问题

###  动态代理模式介绍

![](.\assets\proxy11.png)

-  实现原理
设计动态代理类（DynamicProxy）时，不需要显式实现与目标对象类（RealSubject）相同的接口，而是将这种实现推迟到程序运行时由 JVM来实现 
即：在使用时再创建动态代理类 & 实例 
静态代理则是在代理类实现时就指定与目标对象类（RealSubject）相同的接口
通过Java 反射机制的method.invoke（），通过调用动态代理类对象方法，从而自动调用目标对象的方法

![](D:\enjoy01\pre\代理模式\assets\proxy2.png)、

![](D:\enjoy01\pre\代理模式\assets\proxy3.png)

- 优点
只需要1个动态代理类就可以解决创建多个静态代理的问题，避免重复、多余代码
更强的灵活性 
设计动态代理类（DynamicProxy）时，不需要显式实现与目标对象类（RealSubject）相同的接口，而是将这种实现推迟到程序运行时由 JVM来实现 
在使用时（调用目标对象方法时）才会动态创建动态代理类 & 实例，不需要事先实例化
- 缺点
效率低 
相比静态代理中 直接调用目标对象方法，动态代理则需要先通过Java反射机制 从而 间接调用目标对象方法
应用场景局限 
因为 Java 的单继承特性（每个代理类都继承了 Proxy 类），即只能针对接口 创建 代理类，不能针对类 创建代理类 
即只能动态代理 实现了接口的类
- 应用场景
基于静态代理应用场景下，需要代理对象数量较多的情况下使用动态代理
AOP 领域 
定义：即 Aspect Oriented Programming = 面向切面编程，是OOP的延续、函数式编程的一种衍生范型 
作用：通过预编译方式和运行期动态代理实现程序功能的统一维护。 
优点：降低业务逻辑各部分之间的耦合度 、 提高程序的可重用性 & 提高了开发的效率 
具体应用场景：日志记录、性能统计、安全控制、异常处理等

